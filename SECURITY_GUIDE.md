# ğŸ”’ Security Guide - Cloudflare Workers Bot

## ğŸ›¡ï¸ Keamanan Data Sensitif

### âŒ **Yang TIDAK Disimpan di wrangler.toml:**

```toml
# âŒ JANGAN LAKUKAN INI
name = "my-worker"
main = "index.js"
api_token = "your-api-token"        # âŒ JANGAN
account_id = "your-account-id"      # âŒ JANGAN
zone_id = "your-zone-id"            # âŒ JANGAN
```

### âœ… **Yang DISIMPAN di Environment Variables:**

```javascript
// âœ… CARA YANG BENAR
const envVars = {
    CLOUDFLARE_API_TOKEN: token,      // âœ… Environment variable
    CLOUDFLARE_ACCOUNT_ID: accountId, // âœ… Environment variable
    CLOUDFLARE_ZONE_ID: zoneId        // âœ… Environment variable
};
```

## ğŸ”‘ **Bagaimana Bot Menangani Data Sensitif**

### 1. **Data dari Sesi Login**
```javascript
// Bot mengambil data dari sesi login user
const userData = getUserData(ctx.from.id);
const token = userData.apiToken;
const accountId = userData.accountId;
const zoneId = userData.zoneId;
```

### 2. **Environment Variables**
```javascript
// Bot set environment variables untuk Wrangler CLI
const envVars = {
    ...process.env,
    CLOUDFLARE_API_TOKEN: token,
    CLOUDFLARE_ACCOUNT_ID: accountId,
    CLOUDFLARE_ZONE_ID: zoneId,
    NODE_ENV: 'production'
};
```

### 3. **Wrangler CLI Menggunakan Environment Variables**
```bash
# Wrangler CLI otomatis membaca environment variables
npx wrangler publish
# Tidak perlu parameter --api-token, --account-id, --zone-id
```

## ğŸ“‹ **Struktur wrangler.toml yang Aman**

### âœ… **Konfigurasi yang Benar:**
```toml
# Cloudflare Workers Configuration
# Generated by Telegram Bot
# Note: API Token, Account ID, dan Zone ID disimpan di environment variables

name = "my-worker"
main = "index.js"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]

[build]
command = ""

[env.production]
name = "my-worker"

[vars]
ENVIRONMENT = "production"
```

### âŒ **Konfigurasi yang SALAH:**
```toml
# âŒ JANGAN LAKUKAN INI
name = "my-worker"
main = "index.js"
api_token = "your-api-token"        # âŒ JANGAN
account_id = "your-account-id"      # âŒ JANGAN
zone_id = "your-zone-id"            # âŒ JANGAN
```

## ğŸ”„ **Alur Keamanan Data**

### 1. **Login Process**
```
User Input â†’ Validation â†’ Store in users.json â†’ Session Management
```

### 2. **Deployment Process**
```
Session Data â†’ Environment Variables â†’ Wrangler CLI â†’ Cloudflare API
```

### 3. **Data Flow**
```
Telegram ID â†’ users.json â†’ Environment Variables â†’ Wrangler CLI
```

## ğŸ›¡ï¸ **Best Practices Keamanan**

### 1. **Environment Variables**
```javascript
// âœ… Gunakan environment variables
process.env.CLOUDFLARE_API_TOKEN
process.env.CLOUDFLARE_ACCOUNT_ID
process.env.CLOUDFLARE_ZONE_ID
```

### 2. **Session Management**
```javascript
// âœ… Simpan data per user
const userData = {
    telegramId: ctx.from.id,
    apiToken: token,
    accountId: accountId,
    zoneId: zoneId
};
saveUserData(ctx.from.id, userData);
```

### 3. **Data Validation**
```javascript
// âœ… Validasi data sebelum digunakan
if (!token || !accountId) {
    throw new Error('Data login tidak lengkap');
}
```

### 4. **Cleanup**
```javascript
// âœ… Hapus data temporary
fs.rmSync(tempDir, { recursive: true, force: true });
```

## ğŸ” **Mengapa Environment Variables Lebih Aman?**

### 1. **Tidak Tersimpan di File**
- Data tidak tersimpan di repository
- Tidak ter-commit ke Git
- Tidak ter-expose di file konfigurasi

### 2. **Per-Process Isolation**
- Setiap proses memiliki environment sendiri
- Data tidak ter-share antar proses
- Otomatis terhapus saat proses selesai

### 3. **Wrangler CLI Support**
- Wrangler CLI mendukung environment variables
- Tidak perlu parameter command line
- Lebih aman dan praktis

## ğŸš¨ **Risiko Keamanan yang Dihindari**

### 1. **Exposure di Repository**
```toml
# âŒ Risiko: Data tersimpan di Git
api_token = "your-secret-token"
```

### 2. **Command Line History**
```bash
# âŒ Risiko: Token tersimpan di history
npx wrangler publish --api-token "your-token"
```

### 3. **File System Exposure**
```javascript
// âŒ Risiko: Data tersimpan di file
fs.writeFileSync('config.json', JSON.stringify({token: 'secret'}));
```

## âœ… **Keamanan yang Diterapkan di Bot**

### 1. **Data Storage**
- âœ… Data disimpan per Telegram ID
- âœ… Tidak ada data yang ter-share antar user
- âœ… Cleanup otomatis setelah deploy

### 2. **Environment Variables**
- âœ… API Token di environment variables
- âœ… Account ID di environment variables
- âœ… Zone ID di environment variables

### 3. **Session Management**
- âœ… Validasi data sebelum deploy
- âœ… Error handling untuk data tidak lengkap
- âœ… Logout otomatis jika data invalid

### 4. **File Security**
- âœ… wrangler.toml tidak menyimpan data sensitif
- âœ… Temporary files dihapus setelah deploy
- âœ… Tidak ada hardcoded credentials

## ğŸ”§ **Troubleshooting Keamanan**

### âŒ **Error: "API Token not found"**
**Solusi:**
- Cek apakah user sudah login
- Pastikan data tersimpan di users.json
- Restart bot jika perlu

### âŒ **Error: "Account ID not valid"**
**Solusi:**
- Cek format Account ID
- Pastikan API Token memiliki akses
- Re-login jika perlu

### âŒ **Error: "Zone ID not found"**
**Solusi:**
- Zone ID opsional untuk Workers
- Bisa deploy tanpa Zone ID
- Cek apakah Zone ID valid

## ğŸ“Š **Statistik Keamanan**

| Aspek | Status | Level |
|-------|--------|-------|
| Data Storage | âœ… Aman | Tinggi |
| Environment Variables | âœ… Aman | Tinggi |
| Session Management | âœ… Aman | Tinggi |
| File Security | âœ… Aman | Tinggi |
| Cleanup | âœ… Aman | Tinggi |

## ğŸ¯ **Kesimpulan**

Bot menggunakan praktik keamanan terbaik:

1. âœ… **Environment Variables**: Data sensitif tidak tersimpan di file
2. âœ… **Session Management**: Data per user terisolasi
3. âœ… **Validation**: Validasi data sebelum digunakan
4. âœ… **Cleanup**: Hapus data temporary otomatis
5. âœ… **No Hardcoding**: Tidak ada credentials di kode

**Keamanan data user adalah prioritas utama!** ğŸ”’